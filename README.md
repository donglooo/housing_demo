# Housing Research Data Processor

這是一個用於處理稅籍資料並產出標準化 Excel 報表的工具。

## 功能

- **資料處理**:上傳經過編碼的 CSV 檔案(如 `稅籍_coded_*.csv`),系統將自動轉換代碼為文字(如將 `11` 轉為 `15坪以下`),並產出格式化的 Excel 報表。
- **互動式樞紐分析**:透過 `01_互動區` 頁面,可自訂列/欄維度進行多年度交叉分析,支援資料篩選與年增率計算。
- **設定管理**:透過介面直接修改 `codebook.yaml`,無需更動程式碼即可調整代碼對照表或欄位排序。

## 如何使用

### 資料處理

1.  確認已安裝 Python 環境並執行 `pip install -r requirements.txt` (或直接使用提供的執行檔)。
2.  執行程式:
    ```bash
    streamlit run 首頁.py
    ```
3.  開啟瀏覽器(預設為 `http://localhost:8501`)。
4.  在左側選單選擇 **產製區**。
5.  上傳 CSV 檔案。
6.  點擊 **Run Processing**。
7.  預覽結果並點擊 **Download Styled Excel** 下載報表。

### 互動式樞紐分析

1.  在左側選單選擇 **互動區**。
2.  從下拉選單選擇資料集(支援 `.parquet` 格式)。
3.  設定分析維度:
    - **列維度(Row)**:選擇要作為表格列的欄位
    - **欄維度(Column)**:選擇要作為表格欄的欄位
4.  (選用)在左側邊欄設定篩選條件。
5.  (選用)調整視覺化軸向(全表/直向/橫向)以改變顏色標記方式。
6.  點擊 **查詢** 按鈕。
7.  查看結果:
    - 多年度分頁顯示樞紐分析表
    - 每年度提供四種檢視:原始數值、列百分比、欄百分比、總百分比
    - 年增率分析區塊顯示總體趨勢與各維度成長率

## 設定修改

若需修改代碼對應或是欄位順序:

1.  在左側選單選擇 **Settings**。
2.  直接編輯 YAML 內容。
3.  點擊 **Save Settings** 即時生效。

## 專案結構

```
housing-research/
├── config/          # 設定檔(codebook.yaml)
├── data/            # 資料檔案(.parquet)
├── pages/           # Streamlit 頁面
│   ├── 01_互動區.py  # 互動式樞紐分析
│   └── 02_產製區.py  # 資料處理與報表產製
├── src/
│   ├── core/        # 核心模組
│   │   ├── config_manager.py    # 設定與路徑管理
│   │   ├── data_loader.py       # 資料載入與解碼
│   │   ├── pivot_engine.py      # 樞紐分析運算
│   │   └── ui_components.py     # UI 元件
│   └── excel_export.py          # Excel 報表產出
└── 首頁.py           # 主程式入口
```
